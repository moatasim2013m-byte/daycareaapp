# DAY CARE SYSTEM LOGIC - INDOOR PLAYGROUND
## Arabic-First UI | Full Implementation Specification

---

## A) DAY CARE OFFERINGS (Arabic Names + English Rules)

### 1) Ø­Ø¶Ø§Ù†Ø© â€“ Ù†ØµÙ ÙŠÙˆÙ… (ØµØ¨Ø§Ø­ÙŠ)
**Package Name**: Day Care - Half Day (Morning)  
**Arabic Short Name**: Ù†ØµÙ ÙŠÙˆÙ… ØµØ¨Ø§Ø­ÙŠ

**Included Hours/Shifts**:
- Morning Shift: 7:00 AM - 1:00 PM (6 hours)
- Single shift only

**Included Areas & Limits**:
- Day Care area (primary): Full access during shift
- Indoor Playground: 30 minutes free play time (scheduled mid-morning, 10:00-10:30 AM)
- Sand Area: Not included (can purchase add-on)

**Included Services**:
- Supervision and care
- Snack (mid-morning, 9:30 AM)
- Educational activities (1 hour: arts, crafts, storytelling)
- Nap area available (if child needs rest)

**Eligibility Rules**:
- Age Range: 2-5 years (configurable per plan)
- Required Documents:
  - Birth certificate or ID proof
  - Vaccination records (placeholder, admin defines required vaccines)
  - Medical history form (allergies, chronic conditions, medications)
  - Emergency contact (min 2 contacts)
- Health Requirements:
  - No fever/contagious illness at check-in (staff visual check)
  - Allergy information mandatory (if applicable)

**Capacity Rules**:
- Max Kids per Shift: 20 children (morning shift)
- Staff Ratio: 1 staff : 6 children (configurable)
- Min Staff: 2 (always, for safety)

**Pricing Model**: 
- Single Day: Fixed rate (e.g., 150 SAR/day)
- Monthly Subscription: 24 days/month (weekdays only, Sun-Fri)

**Cancellation/Refund Policy**:
- **Single Day**:
  - >24 hours before shift: 100% refund or credit
  - 12-24 hours: 50% refund
  - <12 hours: No refund (forfeit)
- **Monthly Subscription**:
  - Before first day: 90% refund (10% admin fee)
  - After first week: No refund (can pause, see section E)

---

### 2) Ø­Ø¶Ø§Ù†Ø© â€“ Ù†ØµÙ ÙŠÙˆÙ… (Ù…Ø³Ø§Ø¦ÙŠ)
**Package Name**: Day Care - Half Day (Evening)  
**Arabic Short Name**: Ù†ØµÙ ÙŠÙˆÙ… Ù…Ø³Ø§Ø¦ÙŠ

**Included Hours/Shifts**:
- Evening Shift: 1:00 PM - 7:00 PM (6 hours)
- Single shift only

**Included Areas & Limits**:
- Day Care area: Full access
- Indoor Playground: 30 minutes free play (scheduled, 4:00-4:30 PM)
- Sand Area: Not included (can purchase add-on)

**Included Services**:
- Supervision and care
- Lunch (1:00-1:30 PM, light meal)
- Snack (4:00 PM)
- Educational activities (1 hour: arts, science, games)
- Outdoor time (if weather permits, 30 min)

**Eligibility Rules**: Same as morning shift

**Capacity Rules**:
- Max Kids per Shift: 15 children (evening shift, typically lower demand)
- Staff Ratio: 1:6
- Min Staff: 2

**Pricing Model**: Same as morning (single day + monthly subscription options)

**Cancellation/Refund Policy**: Same as morning shift

---

### 3) Ø­Ø¶Ø§Ù†Ø© â€“ ÙŠÙˆÙ… ÙƒØ§Ù…Ù„
**Package Name**: Day Care - Full Day  
**Arabic Short Name**: ÙŠÙˆÙ… ÙƒØ§Ù…Ù„

**Included Hours/Shifts**:
- Full Day: 7:00 AM - 7:00 PM (12 hours)
- Continuous care (no need to check out between shifts)

**Included Areas & Limits**:
- Day Care area: Full access all day
- Indoor Playground: 1 hour total (can be split: 30 min morning + 30 min afternoon)
- Sand Area: Not included (add-on available)

**Included Services**:
- Full day supervision
- Breakfast (7:30-8:00 AM, light)
- Snack (10:00 AM)
- Lunch (12:30-1:00 PM)
- Snack (3:30 PM)
- Dinner/pre-dinner snack (6:00 PM, light)
- Educational activities: 2 sessions (morning + afternoon, 1 hour each)
- Nap time (mandatory rest period 1:30-3:00 PM, individual mats)
- Outdoor/playground time (scheduled)

**Eligibility Rules**: Same as half-day, plus:
- Recommended for children comfortable with full-day separation
- Parent must provide emergency contact available 24/7

**Capacity Rules**:
- Max Kids per Day: 20 children (full day)
- Staff Ratio: 1:6 (2 shifts of staff: morning team 7-2, evening team 1-7, overlap 1-2 PM)
- Min Staff: 2 per shift

**Pricing Model**:
- Single Day: Premium rate (e.g., 280 SAR/day, ~15% discount vs 2 half-days)
- Monthly Subscription: 22 days/month (allows 2 days off)

**Cancellation/Refund Policy**: Same as half-day

---

### 4) Ø­Ø¶Ø§Ù†Ø© â€“ Ø´Ø§Ù…Ù„ Ø§Ù„ÙƒÙ„ (All-Inclusive)
**Package Name**: Day Care - All-Inclusive  
**Arabic Short Name**: Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©

**Included Hours/Shifts**:
- Full Day: 7:00 AM - 7:00 PM (12 hours)
- Flexible check-in/out within operating hours

**Included Areas & Limits**:
- Day Care area: Full access
- Indoor Playground: Unlimited access during day care hours (supervised group transitions)
- Sand Area: 2 hours per day (scheduled slots: 11:00 AM-12:00 PM or 4:00-5:00 PM)
- Can switch between areas throughout day (with staff escort)

**Included Services**:
- All full-day services (meals, snacks, nap, activities)
- **Additional Premium Services**:
  - Swimming pool access (if available, 30 min, with lifeguard)
  - Special workshops: Art, music, dance (1 session/day, rotating schedule)
  - Personalized activity plan (staff tracks each child's preferences)
  - Photo/video updates sent to parent (3x per day via WhatsApp)
  - Extended late pickup grace period (15 min vs standard 10 min)

**Eligibility Rules**: Same as full day

**Capacity Rules**:
- Max Kids per Day: 15 children (premium package, lower capacity for better attention)
- Staff Ratio: 1:5 (better ratio)
- Min Staff: 3 (one dedicated to transitions between areas)

**Pricing Model**:
- Single Day: Premium++ rate (e.g., 400 SAR/day)
- Monthly Subscription: 20 days/month (premium flexibility)

**Cancellation/Refund Policy**:
- Single Day: >48 hours: 100% refund, 24-48 hours: 70%, <24 hours: 30%
- Monthly: First 3 days: 80% refund, after: no refund (can pause)

---

### 5) Ø¥Ø¶Ø§ÙØ©: Ø³Ø§Ø¹ØªÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ù…Ù„ (Add-On)
**Package Name**: Add-On - 2 Hours Sand Area  
**Arabic Short Name**: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù…Ù„

**Type**: Add-on (can be purchased with any half-day or full-day package)

**Included**:
- Sand Area access: 2 hours (scheduled slot, selected at booking)
- Available slots: 9:00-11:00 AM, 11:00 AM-1:00 PM, 3:00-5:00 PM, 5:00-7:00 PM
- Socks provided (mandatory for sand area)
- Sand play tools (buckets, shovels, molds)
- Supervision by sand area staff

**Requirements**:
- Must have active day care booking for same day
- Child must be checked into day care first
- Staff escorts child to/from sand area

**Capacity**:
- Max 10 day care children in sand area per slot (separate from regular sand bookings)

**Pricing**: Additional fee (e.g., +50 SAR per day)

**Booking**:
- Selected during day care booking OR
- Added after booking (if capacity available) via app/reception

---

### Additional Package Variants (Optional)

#### Ø­Ø¶Ø§Ù†Ø© â€“ Ù†ØµÙ ÙŠÙˆÙ… Ù…Ø¹ Ø§Ù„Ø±Ù…Ù„ (Half Day + Sand Bundle)
- Pre-bundled: Half day (morning or evening) + 2 hours sand
- Discounted vs buying separately
- Single package selection (simpler for parents)

#### Ø­Ø¶Ø§Ù†Ø© â€“ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (5 Ø£ÙŠØ§Ù…) (Weekly Package - 5 Days)
- Prepaid week (Sunday-Thursday)
- Choose shift type: all mornings, all evenings, or mixed
- 10% discount vs 5 single days
- Use case: Short-term visitors, trial period

---

## B) PARENT FLOW (Front-End Button Logic, Arabic UI)

### 1) Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø¶Ø§Ù†Ø© (Select Day Care Screen)

**Purpose**: Entry point to day care booking

**Display**:
- Hero section: "Ø­Ø¶Ø§Ù†Ø© Ø¢Ù…Ù†Ø© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ø·ÙÙ„Ùƒ ğŸ’™"
- Benefits icons:
  - Ø¥Ø´Ø±Ø§Ù Ø§Ø­ØªØ±Ø§ÙÙŠ (Professional supervision)
  - Ø£Ù†Ø´Ø·Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Educational activities)
  - ÙˆØ¬Ø¨Ø§Øª ØµØ­ÙŠØ© (Healthy meals)
  - Ø¨ÙŠØ¦Ø© Ø¢Ù…Ù†Ø© (Safe environment)

**Buttons**:
- Ø§Ø­Ø¬Ø² ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ (Book Single Day) â†’ Navigate to package selection (single-day mode)
- Ø§Ø´ØªØ±Ùƒ Ø´Ù‡Ø±ÙŠØ§Ù‹ (Monthly Subscription) â†’ Navigate to package selection (subscription mode)
- Ø¹Ø±Ø¶ Ø­Ø¬ÙˆØ²Ø§ØªÙŠ (View My Bookings) â†’ Navigate to My Bookings screen

**API Calls**: None (navigation only)

---

### 2) Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© (Select Package Screen)

**Purpose**: Choose day care package type

**Display Package Cards** (for each package):
- Package name (Arabic)
- Shift times (e.g., "7:00 Øµ - 1:00 Ù…")
- Price (per day or per month)
- Included features (bullet list):
  - âœ“ ÙˆØ¬Ø¨Ø§Øª Ø®ÙÙŠÙØ© (Snacks)
  - âœ“ Ø£Ù†Ø´Ø·Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Activities)
  - âœ“ 30 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¹Ø¨ (Playground time)
- Ø´Ø§Ø±Ø© "Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©" (Most Popular badge - if applicable)

**Packages Displayed**:
1. Ù†ØµÙ ÙŠÙˆÙ… (ØµØ¨Ø§Ø­ÙŠ)
2. Ù†ØµÙ ÙŠÙˆÙ… (Ù…Ø³Ø§Ø¦ÙŠ)
3. ÙŠÙˆÙ… ÙƒØ§Ù…Ù„
4. Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©

**For Each Package Card**:
- **Button**: Ø§Ø®ØªØ± (Select)

**On Select**:
- If single-day mode:
  - API: GET /api/daycare/availability?package_id={id}&date={today}
  - Check capacity available for selected shift
  - If available: Navigate to date selection
  - If full: Show "âš ï¸ Ø§Ù„ÙØªØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø©ØŒ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ø§Ù‹ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ù†Ø¶Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"
- If subscription mode:
  - Navigate directly to child selection (availability checked at checkout)

---

### 3) Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙŠØ§Ù… (Select Days Screen)

**Two Modes**: Single Day vs Monthly Subscription

#### Mode A: Single Day Booking

**Display**:
- Calendar widget (current month + next 30 days)
- Availability indicators:
  - Green dot: Ù…ØªØ§Ø­ (Available)
  - Yellow dot: Ù…Ù‚Ø§Ø¹Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ø© (Limited spots)
  - Red X: Ù…Ù…ØªÙ„Ø¦ (Full)
  - Gray: ØºÙŠØ± Ù…ØªØ§Ø­ (Not available - weekends/holidays for weekday-only plans)

**Interaction**:
- Tap date â†’ Select (highlight border)
- Display capacity info: "Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: 5 Ù…Ù† 20"

**Button**: Ø§Ù„ØªØ§Ù„ÙŠ (Next)

**Validations**:
- Date must be future (not past)
- Date must be available (capacity > 0)
- Cannot book >30 days in advance (configurable)

**API Calls**:
- On Load: GET /api/daycare/calendar?package_id={id}&month={YYYY-MM}
  - Response: {dates: [{date, capacity_available, status}]}
- On Next: Store selected_date, navigate to child info

---

#### Mode B: Monthly Subscription

**Display**:
- "Ø§Ø®ØªØ± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹" (Choose preferred weekday schedule)
- Checkboxes for weekdays:
  - â˜ Ø§Ù„Ø£Ø­Ø¯ (Sunday)
  - â˜ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† (Monday)
  - â˜ Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ (Tuesday)
  - â˜ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ (Wednesday)
  - â˜ Ø§Ù„Ø®Ù…ÙŠØ³ (Thursday)
  - â˜ Ø§Ù„Ø¬Ù…Ø¹Ø© (Friday - if allowed)
  - Ø§Ù„Ø³Ø¨Øª (Saturday) - grayed out (rest day)

**Note**: "ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¶ÙˆØ± 24 ÙŠÙˆÙ…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø´Ù‡Ø±. Ø§Ø®ØªØ± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØ£ÙƒÙŠØ¯ ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹."

**Date Picker**:
- "ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" (Subscription start date)
- Default: Next Sunday (or next available weekday)
- Max 14 days in future

**Button**: Ø§Ù„ØªØ§Ù„ÙŠ (Next)

**Validations**:
- Must select at least 3 weekdays
- Start date must be future

**API Calls**:
- On Next: Store selected_weekdays + start_date, navigate to child info

---

### 4) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ (Child Information Screen)

**Purpose**: Enter/select child details

**Display**:

**Section 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·ÙÙ„ (Select Child)**
- If parent has registered children:
  - Radio buttons with child cards (name, age, photo)
  - â˜ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·ÙÙ„ Ù…Ø³Ø¬Ù„ (Use existing child)
- Ø¥Ø¶Ø§ÙØ© Ø·ÙÙ„ Ø¬Ø¯ÙŠØ¯ (Add new child) - selected by default if no children

**Section 2: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·ÙÙ„ (Child Details)** - shown if "new child" selected

**Required Fields**:
- Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ (Child Name) - text input
- ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Date of Birth) - date picker
- Ø§Ù„Ø¬Ù†Ø³ (Gender) - dropdown: Ø°ÙƒØ± (Male), Ø£Ù†Ø«Ù‰ (Female)
- ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„ (Child Photo) - upload button (optional but recommended)

**Section 3: Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø§Ø±Ø¦Ø© (Emergency Contacts)** - collapsible, required

**Contact 1** (Primary):
- Ø§Ø³Ù… Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (Contact Name) - text
- Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© (Relationship) - dropdown: Ø£Ù… (Mother), Ø£Ø¨ (Father), Ø¬Ø¯Ø© (Grandmother), Ø¬Ø¯ (Grandfather), Ø£Ø®Ø±Ù‰ (Other)
- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Phone Number) - with validation (+966...)
- â˜‘ï¸ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·ÙÙ„ (Authorized to pick up child) - checkbox

**Contact 2** (Secondary):
- Same fields as Contact 1
- Labeled "Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ Ø¨Ø¯ÙŠÙ„Ø©" (Backup contact)

**Validations**:
- Child name: Required, min 2 chars
- Age: Must be within package eligibility (2-5 years, calculated from DOB)
- If age out of range: Show "âš ï¸ Ø¹Ù…Ø± Ø§Ù„Ø·ÙÙ„ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 2-5 Ø³Ù†ÙˆØ§Øª)"
- Emergency contacts: Both required, phone numbers must be valid, at least one must be authorized for pickup

**Button**: Ø§Ù„ØªØ§Ù„ÙŠ (Next)

**API Calls**:
- If using existing child: GET /api/children/{child_id}/profile
- If new child: Store data locally (will create on final submit)
- On Next: Navigate to health notes screen

---

### 5) Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµØ­ÙŠØ© ÙˆØ§Ù„Ø­Ø³Ø§Ø³ÙŠØ© (Health Notes & Allergies Screen)

**Purpose**: Critical health information for staff safety

**Display**:

**Section 1: Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© (Allergies)**

**Question**: "Ù‡Ù„ ÙŠØ¹Ø§Ù†ÙŠ Ø§Ù„Ø·ÙÙ„ Ù…Ù† Ø£ÙŠ Ø­Ø³Ø§Ø³ÙŠØ©ØŸ"
- â˜ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø³ÙŠØ© (No allergies) - checked by default
- â˜ Ù†Ø¹Ù…ØŒ Ù„Ø¯ÙŠÙ‡ Ø­Ø³Ø§Ø³ÙŠØ© (Yes, has allergies)

**If "Yes" selected**:
- Show multi-select checkboxes:
  - â˜ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø·Ø¹Ø§Ù… (Food allergy) â†’ Text field: "Ø­Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø¹Ù…Ø©" (Specify foods)
  - â˜ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© (Medication allergy) â†’ Text field
  - â˜ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØºØ¨Ø§Ø±/Ø­Ø¨ÙˆØ¨ Ø§Ù„Ù„Ù‚Ø§Ø­ (Dust/pollen)
  - â˜ Ø£Ø®Ø±Ù‰ (Other) â†’ Text field

**Section 2: Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ© (Medical Conditions)**

**Question**: "Ù‡Ù„ ÙŠØ¹Ø§Ù†ÙŠ Ø§Ù„Ø·ÙÙ„ Ù…Ù† Ø£ÙŠ Ø­Ø§Ù„Ø© ØµØ­ÙŠØ© Ù…Ø²Ù…Ù†Ø©ØŸ"
- â˜ Ù„Ø§ (No)
- â˜ Ù†Ø¹Ù… (Yes) â†’ Text area: "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¶ÙŠØ­" (Please explain)

**Examples displayed** (placeholder text): "Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø¨ÙˆØŒ Ø§Ù„Ø³ÙƒØ±ÙŠØŒ Ø§Ù„ØµØ±Ø¹ØŒ Ø¥Ù„Ø®"

**Section 3: Ø§Ù„Ø£Ø¯ÙˆÙŠØ© (Medications)**

**Question**: "Ù‡Ù„ ÙŠØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø·ÙÙ„ Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø¨Ø§Ù†ØªØ¸Ø§Ù…ØŸ"
- â˜ Ù„Ø§ (No)
- â˜ Ù†Ø¹Ù… (Yes) â†’ Show fields:
  - Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ (Medication name) - text
  - Ø§Ù„Ø¬Ø±Ø¹Ø© ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØª (Dosage & timing) - text
  - ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ø¡ (Staff can administer) - â˜ Ù†Ø¹Ù… â˜ Ù„Ø§
  - If "Yes": "âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø­Ø¶Ø§Ø± ÙˆØµÙØ© Ø·Ø¨ÙŠØ© ÙˆØªÙˆÙ‚ÙŠØ¹ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©" (Prescription & consent form required)

**Section 4: Ù‚ÙŠÙˆØ¯ ØºØ°Ø§Ø¦ÙŠØ© (Dietary Restrictions)**

**Question**: "Ù‡Ù„ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯ ØºØ°Ø§Ø¦ÙŠØ©ØŸ"
- â˜ Ù„Ø§ (No)
- â˜ Ù†Ø¨Ø§ØªÙŠ (Vegetarian)
- â˜ Ø¨Ø¯ÙˆÙ† Ù…Ø´ØªÙ‚Ø§Øª Ø§Ù„Ø­Ù„ÙŠØ¨ (Dairy-free)
- â˜ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¬Ù„ÙˆØªÙŠÙ† (Gluten-free)
- â˜ Ø£Ø®Ø±Ù‰ (Other) â†’ Text field

**Section 5: Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Additional Notes)**
- Text area (optional)
- Placeholder: "Ù…Ø«Ø§Ù„: Ø§Ù„Ø·ÙÙ„ ÙŠØ­Ø¨ Ø§Ù„Ù‚ÙŠÙ„ÙˆÙ„Ø©ØŒ ÙŠØ®Ø§Ù Ù…Ù† Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©ØŒ Ø¥Ù„Ø®"

**Consent Checkbox** (required):
- â˜‘ï¸ "Ø£Ø¤ÙƒØ¯ Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡ ØµØ­ÙŠØ­Ø© ÙˆÙƒØ§Ù…Ù„Ø©. Ø£ÙÙ‡Ù… Ø£Ù† Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØ­ÙŠØ© Ù…Ù‡Ù…Ø© Ù‚Ø¯ ÙŠØ¹Ø±Ø¶ Ø·ÙÙ„ÙŠ Ù„Ù„Ø®Ø·Ø±."

**Buttons**:
- Ø±Ø¬ÙˆØ¹ (Back) â†’ Previous screen
- Ø§Ù„ØªØ§Ù„ÙŠ (Next)

**Validations**:
- If any allergy selected, specification text required
- If medications "Yes", medication details required
- Consent checkbox must be checked

**API Calls**: None (store locally, submit at payment)

---

### 6) Ø§Ù„Ø¯ÙØ¹ (Payment Screen)

**Purpose**: Review and confirm booking, process payment

**Display**:

**Section 1: Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¬Ø² (Booking Summary)**

**Display Info**:
- Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø© (Package type): [package_name_ar]
- Ø§Ù„ÙØªØ±Ø© (Shift): [shift_time]
- Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ (Child name): [child_name]
- Ø§Ù„ØªØ§Ø±ÙŠØ® (Date): [selected_date] OR
- Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Weekdays): [selected_weekdays] - if subscription
- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ (Start date): [start_date] - if subscription

**Section 2: Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª (Add-Ons)** - optional

**Display Available Add-Ons**:
- â˜ Ø¥Ø¶Ø§ÙØ©: Ø³Ø§Ø¹ØªÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ù…Ù„ (+50 Ø±ÙŠØ§Ù„)
  - If checked: Show time slot selector (9-11 AM, 11-1 PM, 3-5 PM, 5-7 PM)
- â˜ Ø¥Ø¶Ø§ÙØ©: ÙˆØ¬Ø¨Ø© Ø¥Ø¶Ø§ÙÙŠØ© (+20 Ø±ÙŠØ§Ù„) - for half-day packages
- â˜ Ø¥Ø¶Ø§ÙØ©: ØªØ£Ù…ÙŠÙ† Ø´Ø§Ù…Ù„ (+30 Ø±ÙŠØ§Ù„/Ø´Ù‡Ø±) - for subscriptions

**Section 3: ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ (Payment Details)**

**Display**:
- Ø³Ø¹Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© (Package price): XXX Ø±ÙŠØ§Ù„
- Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª (Add-ons): +XX Ø±ÙŠØ§Ù„
- Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (Tax 15%): XX Ø±ÙŠØ§Ù„
- **Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Total)**: XXX Ø±ÙŠØ§Ù„

**Coupon Field**:
- Ø±Ù…Ø² Ø§Ù„Ø®ØµÙ… (Coupon code) - text input
- ØªØ·Ø¨ÙŠÙ‚ (Apply) button
  - API: POST /api/coupons/validate
  - Body: {coupon_code, service_type: 'daycare', package_id}
  - If valid: Update total, show discount line: "Ø§Ù„Ø®ØµÙ…: -XX Ø±ÙŠØ§Ù„"
  - If invalid: "âŒ Ø±Ù…Ø² Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ§Ù„Ø­"

**Section 4: Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (Payment Method)**

**Radio buttons**:
- â˜ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†/Ù…Ø¯Ù‰ (Credit/Debit Card)
- â˜ Apple Pay (if available)
- â˜ STC Pay / Mada Pay (local wallets)

**Checkboxes**:
- â˜‘ï¸ Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… (Accept terms - required)
- â˜ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Save payment info - optional)
- â˜ ØªØ¬Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Auto-renewal - only for subscriptions, optional)

**Buttons**:
- Ø±Ø¬ÙˆØ¹ (Back)
- Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù† (Pay Now)

**On Pay Now**:

**Validations**:
- Terms checkbox must be checked
- Payment method selected
- If add-on selected, time slot selected

**API Call**:
- POST /api/daycare/bookings/checkout
- Body (single day):
  ```json
  {
    "package_id": "uuid",
    "child_id": "uuid_or_null",
    "child_data": {name, dob, gender, photo_url, emergency_contacts, health_notes},
    "booking_date": "2026-01-20",
    "shift": "morning",
    "add_ons": [{type: "sand", time_slot: "9-11"}],
    "coupon_code": "ABC123",
    "payment_method": "card",
    "auto_save_child": true
  }
  ```
- Body (subscription):
  ```json
  {
    "package_id": "uuid",
    "child_id": "uuid_or_null",
    "child_data": {...},
    "subscription_start_date": "2026-02-01",
    "weekdays": ["sun","mon","tue","wed","thu"],
    "shift": "morning",
    "add_ons": [],
    "coupon_code": "",
    "auto_renew": false
  }
  ```

**Response**:
- Success: {payment_url, booking_id OR subscription_id}
- Redirect to payment gateway
- After payment success: Webhook updates booking status to 'confirmed'
- Redirect back to success screen

**Success Screen**:
- "âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ Ø¨Ù†Ø¬Ø§Ø­!"
- Booking details displayed
- QR code image (for check-in)
- **Buttons**:
  - Ø­ÙØ¸ Ø±Ù…Ø² QR (Save QR Code) â†’ Download image
  - Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Add to Calendar) â†’ iCal export
  - Ø¹Ø±Ø¶ Ø­Ø¬ÙˆØ²Ø§ØªÙŠ (View My Bookings)

**Notifications Sent**:
- WhatsApp: "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ø§Ù„Ø­Ø¶Ø§Ù†Ø© Ù„Ù€[child_name] ÙŠÙˆÙ… [date] Ø§Ù„ÙØªØ±Ø© [shift]. Ø±Ù…Ø² Ø§Ù„Ø­Ø¬Ø²: DC12345"
- SMS: Same message + QR code link
- Email: Detailed confirmation with:
  - Booking details
  - QR code attachment
  - Health notes confirmation
  - Facility address & contact
  - What to bring (diapers, change of clothes, etc.)

---

### 7) Ø­Ø¬ÙˆØ²Ø§ØªÙŠ (Ø§Ù„Ø­Ø¶Ø§Ù†Ø©) (My Bookings - Day Care Screen)

**Purpose**: View and manage day care bookings

**Tabs**:
- Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Upcoming) - default
- Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (Completed)
- Ø§Ù„Ù…Ù„ØºØ§Ø© (Cancelled)

**For Each Booking Card** (in Upcoming tab):

**Display**:
- Package name (Arabic)
- Child name + photo (small)
- Date (for single day) OR "Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ" (Monthly subscription) badge
- Shift time (e.g., "7:00 Øµ - 1:00 Ù…")
- Status badge:
  - Ù…Ø¤ÙƒØ¯ (Confirmed) - green
  - Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Pending payment) - yellow
  - ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Checked In) - blue
  - Ù…ÙƒØªÙ…Ù„ (Completed) - gray

**Buttons**:
- Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (View Details) â†’ Navigate to booking details screen
- Ø¹Ø±Ø¶ Ø±Ù…Ø² QR (Show QR) â†’ Show QR code modal (refresh every 5 min for rotating token)
- Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² (Cancel) - only if status='confirmed' and >24 hours before
- Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¬Ø² (Rebook) - for completed/cancelled bookings

**Booking Details Screen**:

**Sections**:
1. **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø² (Booking Info)**:
   - Booking number (DC12345)
   - Package, shift, date
   - Amount paid
   - Payment method

2. **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·ÙÙ„ (Child Info)**:
   - Name, age, photo
   - Emergency contacts (expandable)
   - Health notes summary (expandable)

3. **Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª (Add-Ons)** (if any):
   - Sand area: 11:00 AM - 1:00 PM
   - Extra meal

4. **Ø§Ù„Ø­Ø¶ÙˆØ± (Attendance)**:
   - Check-in time: [time] OR "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯" (Not checked in yet)
   - Check-out time: [time] OR "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯"
   - Duration: [X] hours [Y] minutes

5. **Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· (Activity Log)** (optional, if tracked):
   - Playground time: 10:00-10:30 AM âœ“
   - Snack time: 9:30 AM âœ“
   - Educational activity: 11:00 AM âœ“

**Buttons**:
- ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Download Invoice) - PDF
- Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø© (Report Issue) - opens support chat
- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµØ­ÙŠØ© (Edit Health Notes) - if >24 hours before booking

**API Calls**:
- On Load (My Bookings): GET /api/daycare/bookings?user_id={id}&status=upcoming,completed
- View Details: GET /api/daycare/bookings/{booking_id}
- Show QR: GET /api/daycare/bookings/{booking_id}/qr â†’ Returns fresh QR image URL
- Cancel: POST /api/daycare/bookings/{booking_id}/cancel â†’ Body: {reason}

**Cancel Confirmation Modal**:
- "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²ØŸ"
- Refund info displayed based on cancellation policy
- Dropdown: "Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡" (Cancellation reason) - required
  - Ù…Ø±Ø¶ Ø§Ù„Ø·ÙÙ„ (Child illness)
  - ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø·Ø· (Change of plans)
  - Ø¸Ø±ÙˆÙ Ø·Ø§Ø±Ø¦Ø© (Emergency)
  - Ø£Ø®Ø±Ù‰ (Other)
- Buttons: ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (Confirm Cancel), Ø±Ø¬ÙˆØ¹ (Back)

**Success**: "âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø². Ø³ÙŠØªÙ… Ø±Ø¯ Ø§Ù„Ù…Ø¨Ù„Øº Ø®Ù„Ø§Ù„ 7-10 Ø£ÙŠØ§Ù…." (if refund applicable)

---

## C) RECEPTION FLOW (POS + Day Care, Arabic UI)

### 1) Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ â€“ Ø­Ø¶Ø§Ù†Ø© Ø§Ù„ÙŠÙˆÙ… (Reception Dashboard - Day Care Today)

**Purpose**: Staff view of today's day care bookings and walk-ins

**Display**:

**Header Metrics** (today's stats):
- Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© (Confirmed bookings): 18
- ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Checked in): 12
- Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (Remaining capacity): 8/20 (morning), 10/15 (evening)
- ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Waitlist): 2

**Tabs**:
- Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© (Morning Shift) - default if before 1 PM
- Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© (Evening Shift)
- ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ (Full Day)

**For Each Shift Tab**:

**Table/List View** (sortable):

**Columns**:
- # (Ø±Ù‚Ù…)
- Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ (Child Name) + photo
- ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Parent Name) + phone
- Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø© (Package Type)
- Ø§Ù„Ø­Ø§Ù„Ø© (Status):
  - Ù…Ø¤ÙƒØ¯ (Confirmed)
  - ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Checked In) - with time badge
  - ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Checked Out)
  - ØªØ£Ø®Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Late Pickup) - red badge
- Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª (Actions)

**Action Buttons** (per row):
- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Check In) - if status = 'confirmed'
- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Check Out) - if status = 'checked_in'
- Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (View Details)
- Ø¥Ø¶Ø§ÙØ§Øª (Add-Ons) - opens add-on purchase modal

**Top Actions**:
- â• Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ (New Walk-In Booking) â†’ Navigate to walk-in booking flow
- ğŸ” Ø¨Ø­Ø« (Search) - by child name, parent phone, booking number
- ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… (Today's Report) â†’ Generate PDF/Excel

**Filters**:
- Ø§Ù„Ø­Ø§Ù„Ø© (Status): Ø§Ù„ÙƒÙ„ (All), Ù…Ø¤ÙƒØ¯, ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„, ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
- Sort by: Ø§Ù„Ø§Ø³Ù… (Name), ÙˆÙ‚Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Check-in time), ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Parent)

**API Calls**:
- On Load: GET /api/reception/daycare/today?shift=morning,evening,fullday
- Response: List of bookings with child, parent, package, status info

---

### 2) ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø·ÙÙ„ (Check-In Child Screen/Modal)

**Purpose**: Staff checks in a child (QR scan or manual)

**Two Methods**:

#### Method A: QR Scan (Preferred)

**Display**:
- QR scanner interface (uses device camera or connected scanner)
- "Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø­Ø¬Ø²" (Scan booking QR code)
- Live camera preview

**On Scan**:
- Decode QR â†’ Extract booking_id + checksum
- API: POST /api/daycare/check-in
- Body: {booking_id, device_id, timestamp, method: 'qr'}

**Validation Backend** (see Section D for full logic):
- Verify checksum
- Check booking exists & status='confirmed'
- Check shift time window (can check in 30 min early to 30 min late)
- Check not already checked in
- Check health screening (staff does visual check)

**If Success**:
- Update booking status='checked_in', check_in_time=now
- Return child info + health alerts
- Display success screen (see below)

**If Fail**:
- Show error message (Arabic, see Section D)
- Option to proceed with manual override (requires supervisor approval)

---

#### Method B: Manual Check-In (Backup)

**Display**:
- Search field: "Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" (Search by name or phone)
- Autocomplete results as user types

**On Select Child**:
- Display booking details:
  - Child name, photo
  - Package, shift
  - Parent name, phone
  - âš ï¸ Health alerts (if any): "Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ÙÙˆÙ„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ" (Peanut allergy)
- Checkbox: â˜‘ï¸ "ØªÙ… Ø§Ù„ÙØ­Øµ Ø§Ù„ØµØ­ÙŠ" (Health screening done) - required
  - Staff visually checks: No fever, no visible illness, alert/responsive
- Text field: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" (Check-in notes) - optional
  - Example: "Ø§Ù„Ø·ÙÙ„ Ù†Ø¹Ø³Ø§Ù† Ù‚Ù„ÙŠÙ„Ø§Ù‹" (Child a bit sleepy)

**Button**: ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Confirm Check-In)

**API Call**: Same as QR method, but method='manual'

---

**Check-In Success Screen** (both methods):

**Display**:
- âœ… "Ù…Ø±Ø­Ø¨Ø§Ù‹ [child_name]! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­"
- Check-in time: [HH:MM]
- Expected check-out: [HH:MM] (shift end time)

**âš ï¸ Health Alerts Box** (if applicable):
- Red border, large text
- "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØµØ­ÙŠØ© Ù…Ù‡Ù…Ø©:"
- List of allergies/medications (from health notes)
- "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø·ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…"

**Assigned Staff** (optional):
- Dropdown: "Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„" (Assigned staff member)
- Select from available staff list
- Stores staff_id with attendance record

**Buttons**:
- Ø·Ø¨Ø§Ø¹Ø© Ø³ÙˆØ§Ø± Ø§Ù„Ù…Ø¹ØµÙ… (Print Wristband) - if wristband printer available
  - Wristband contains: Child name, booking number, shift end time, allergy icons (if any)
- Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Send Parent Notification) - auto-sent by default
- ØªÙ… (Done) â†’ Return to dashboard

**Parent Notification Sent**:
- WhatsApp: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ [child_name] Ø§Ù„Ø³Ø§Ø¹Ø© [time] âœ…"
- If health alerts exist: "ØªØ°ÙƒÙŠØ±: ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø·ÙÙ„Ùƒ"

**API Call**:
- POST /api/notifications/parent
- Body: {booking_id, type: 'check_in', timestamp}

---

### 3) ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø·ÙÙ„ (Check-Out Child Screen/Modal)

**Purpose**: Staff checks out a child and hands to parent/authorized pickup

**Two Methods**: QR Scan OR Manual (same as check-in)

#### QR Scan Check-Out:

**Process**:
- Scan QR code
- API: POST /api/daycare/check-out
- Body: {booking_id, device_id, timestamp, method: 'qr'}

**Backend Validation**:
- Booking exists & status='checked_in'
- check_in_time not null
- check_out_time null (not already checked out)

**If Success**:
- Set check_out_time=now
- Calculate actual_duration
- Check for late pickup (see Section D)
- Return duration + late fees (if any)

---

#### Manual Check-Out:

**Display**:
- Search: "Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„" (Search by child name)
- Filter: Only show currently checked-in children
- Select child from results

**Display Confirmation Screen**:
- Child name, photo
- Check-in time: [HH:MM]
- Expected check-out: [HH:MM]
- Current time: [HH:MM]
- **Late pickup indicator** (if applicable):
  - â° "ØªØ£Ø®Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: 25 Ø¯Ù‚ÙŠÙ‚Ø©"
  - "Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: 50 Ø±ÙŠØ§Ù„"

**Section: Pickup Authorization**

**Required**: Verify who is picking up child

**Display**:
- "Ù…Ù† ÙŠØ³ØªÙ„Ù… Ø§Ù„Ø·ÙÙ„ØŸ" (Who is picking up the child?)
- Radio buttons:
  - â˜ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Parent) - [parent_name] - [phone]
  - â˜ Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ Ø·ÙˆØ§Ø±Ø¦ 1 (Emergency contact 1) - [name]
  - â˜ Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ Ø·ÙˆØ§Ø±Ø¦ 2 (Emergency contact 2) - [name]
  - â˜ Ø´Ø®Øµ Ø¢Ø®Ø± (Other person) - requires manager approval

**If "Other person"**:
- Show fields:
  - Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ (Person name) - text
  - Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (ID number) - text
  - Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ø·ÙÙ„ (Relationship) - text
  - Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Phone) - text
- Checkbox: â˜‘ï¸ "ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©" (ID verified) - required
- Checkbox: â˜‘ï¸ "ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" (Parent approval obtained) - required
  - Staff must call parent to confirm authorization
  - Log phone call in notes

**Section: Child Condition Report**

**Checkboxes** (staff assessment):
- â˜‘ï¸ Ø§Ù„Ø·ÙÙ„ Ø¨ØµØ­Ø© Ø¬ÙŠØ¯Ø© (Child in good health)
- â˜ Ø­Ø¯Ø« Ø£ÙŠ Ø­Ø§Ø¯Ø«/Ø¥ØµØ§Ø¨Ø© (Any incident/injury) â†’ If checked, show incident report fields:
  - Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯Ø« (Incident type): Ø³Ù‚ÙˆØ· (Fall), Ø®Ø¯Ø´ (Scratch), Ø£Ø®Ø±Ù‰ (Other)
  - Ø§Ù„ÙˆØµÙ (Description) - text area
  - Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (First aid provided) - text
  - ØªÙ… Ø¥Ø¨Ù„Ø§Øº ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Parent notified) - â˜‘ï¸
- â˜ Ø§Ù„Ø·ÙÙ„ Ù…ØªØ¹Ø¨/Ù†Ø¹Ø³Ø§Ù† (Child tired/sleepy) - normal note
- â˜ Ù„Ù… ÙŠØ£ÙƒÙ„ Ø¬ÙŠØ¯Ø§Ù‹ (Did not eat well) - note for parent

**Text Area**: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" (Additional notes) - optional

**Button**: ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Confirm Check-Out)

**API Call**:
- POST /api/daycare/check-out
- Body:
  ```json
  {
    "booking_id": "uuid",
    "check_out_time": "2026-01-20T13:05:00Z",
    "picked_up_by": {
      "type": "parent" | "emergency_contact_1" | "emergency_contact_2" | "other",
      "name": "if other",
      "id_number": "if other",
      "phone": "if other",
      "parent_approval_obtained": true/false
    },
    "child_condition": {
      "health_status": "good",
      "incidents": [{type, description, first_aid}],
      "notes": "text"
    },
    "late_pickup_minutes": 25,
    "late_pickup_fee": 50.00,
    "staff_id": "uuid"
  }
  ```

---

**Check-Out Success Screen**:

**Display**:
- âœ… "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ [child_name] Ø¨Ù†Ø¬Ø§Ø­"
- Check-out time: [HH:MM]
- Duration: [X] hours [Y] minutes

**If Late Pickup Fee**:
- âš ï¸ "Ø±Ø³ÙˆÙ… ØªØ£Ø®ÙŠØ± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: 50 Ø±ÙŠØ§Ù„"
- "Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„ÙØ§ØªÙˆØ±Ø©" (Status: Added to invoice)
- **Payment Options**:
  - Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø§Ù„Ø¢Ù† (Pay cash now) - button opens cash payment flow
  - Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Pay by card) - button opens POS terminal
  - Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ø³Ø§Ø¨ (Add to account) - for monthly subscription customers
  - Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹ (Pay later) - parent receives invoice via WhatsApp

**Buttons**:
- Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ (Print Receipt) - includes check-in/out times, duration, fees, child condition notes
- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Send Report to Parent) - WhatsApp
- ØªÙ… (Done)

**Parent Notification Sent**:
- WhatsApp message:
  - "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ [child_name] Ø§Ù„Ø³Ø§Ø¹Ø© [time] âœ…"
  - "Ø§Ù„Ù…Ø¯Ø©: [duration]"
  - "Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙÙ„: [condition summary]"
  - If incident: "âš ï¸ Ø­Ø¯Ø« Ø­Ø§Ø¯Ø« Ø¨Ø³ÙŠØ· (Ø®Ø¯Ø´)ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙÙ‚"
  - If late fee: "Ø±Ø³ÙˆÙ… ØªØ£Ø®ÙŠØ± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: 50 Ø±ÙŠØ§Ù„"
  - Attach PDF receipt

---

### 4) ØªÙ…Ø¯ÙŠØ¯/Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ© (Extension/Additional Fees Screen)

**Purpose**: Handle late pickups, extensions, additional services

**Trigger**: When parent calls/arrives and needs extra time

**Display**:
- Search for child (by name)
- Select child (must be checked in)

**Child Info Displayed**:
- Name, photo
- Current shift end time: [HH:MM]
- Current time: [HH:MM]
- Overstay: [X] minutes (if already past end time)

**Section: Extension Request**

**Options**:
- â˜ ØªÙ…Ø¯ÙŠØ¯ 30 Ø¯Ù‚ÙŠÙ‚Ø© (+30 Ø±ÙŠØ§Ù„) (Extend 30 min)
- â˜ ØªÙ…Ø¯ÙŠØ¯ 1 Ø³Ø§Ø¹Ø© (+50 Ø±ÙŠØ§Ù„) (Extend 1 hour)
- â˜ ØªÙ…Ø¯ÙŠØ¯ 2 Ø³Ø§Ø¹Ø© (+90 Ø±ÙŠØ§Ù„) (Extend 2 hours)
- â˜ ØªÙ…Ø¯ÙŠØ¯ Ù…Ø®ØµØµ (Custom extension) â†’ Input field: Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (Minutes)

**Calculate New End Time**: 
- Display: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯: [new_end_time]"

**Payment Method**:
- Radio buttons:
  - Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ (Cash)
  - Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† (Card)
  - Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Add to monthly invoice - if subscription customer)

**Button**: ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ (Confirm Extension)

**API Call**:
- POST /api/daycare/bookings/{booking_id}/extend
- Body: {extension_minutes, payment_method, paid_amount}

**Success**:
- Update booking.extended_end_time
- Create fee ledger entry
- Send parent notification: "ØªÙ… ØªÙ…Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶Ø§Ù†Ø© Ø­ØªÙ‰ [new_end_time] âœ…"

---

### 5) ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù†Ø´Ø§Ø· Ø¥Ø¶Ø§ÙÙŠ (Transfer to Add-On Activity)

**Purpose**: Move checked-in child to playground/sand area mid-day

**Scenario**: Parent purchases add-on (sand time) after check-in, or child transitions to included playground time

**Display**:
- Search child (must be checked in to day care)
- Select child

**Available Add-Ons** (based on package):
- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ù…Ù„ â€“ Ø³Ø§Ø¹ØªÙŠÙ† (Sand Area - 2 hours)
- Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© â€“ Ø³Ø§Ø¹Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Indoor Playground - Extra hour)

**For Each Add-On**:
- Price (if not included)
- Available time slots (dropdown)
- Capacity indicator: "Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: 3"

**Select add-on + time slot**

**If Not Included** (requires payment):
- Show payment section (same as extension)
- Collect payment before proceeding

**Button**: ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‚Ù„ (Confirm Transfer)

**API Call**:
- POST /api/daycare/bookings/{booking_id}/add-activity
- Body: {activity_type: 'sand', time_slot: '11-13', paid: true/false, amount}

**Process**:
- Create add-on session record
- Staff escorts child to designated area
- Notify area staff: "Ø·ÙÙ„ Ù…Ù† Ø§Ù„Ø­Ø¶Ø§Ù†Ø© Ù‚Ø§Ø¯Ù…: [child_name]ØŒ Ø§Ù„ÙØªØ±Ø©: 11:00-1:00"
- Set reminder to bring child back to day care at end of slot

**Success**: "âœ… ØªÙ… Ù†Ù‚Ù„ [child_name] Ø¥Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ù…Ù„. Ø§Ù„Ù…ÙˆØ¹Ø¯: 11:00-1:00 Ù…"

---

## D) CHECK-IN / CHECK-OUT LOGIC (English + Arabic Messages)

### 1) Earliest Allowed Check-In

**Rule**: **30 minutes before shift start time**

**Examples**:
- Morning shift (7:00 AM): Earliest check-in = 6:30 AM
- Evening shift (1:00 PM): Earliest check-in = 12:30 PM
- Full day (7:00 AM): Earliest check-in = 6:30 AM

**Before Window**:
- QR scan or manual check-in â†’ **REJECT**
- Message: "â° Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø­Ø¬Ø². ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† [earliest_time]"
- Offer: "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ØŸ" (Would you like to wait in reception area?)

**Exception (Early Drop-Off Service)**:
- If facility offers paid early drop-off:
  - Before 6:30 AM for morning shift â†’ Extra fee (e.g., +30 SAR/30 min)
  - Staff asks parent: "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙƒØ±ØŸ (Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©: 30 Ø±ÙŠØ§Ù„)" (Would you like early drop-off service? Extra fee: 30 SAR)
  - If accepted: Process payment, allow check-in, mark as 'early_dropoff'

---

### 2) Late Arrival Handling

**Grace Period**: **30 minutes after shift start time**

**Window**: Shift start to shift start + 30 min

**Within Grace Period**:
- Check-in **ALLOWED**
- Mark as 'late_arrival' in attendance record
- Log late_minutes (e.g., 15 min late)
- Message to staff: "âš ï¸ [child_name] ØªØ£Ø®Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù† Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±"
- No penalty fee (within grace)
- Session **still ends at original shift end time** (child loses time)

**Example**:
- Morning shift: 7:00 AM - 1:00 PM
- Arrives: 7:20 AM (20 min late, within grace)
- Check-in allowed
- Session ends: 1:00 PM (loses 20 min)

**After Grace Period (>30 min late)**:

**Cutoff**: **1 hour after shift start**

**Between 30-60 min late**:
- Check-in **ALLOWED with warning**
- Message to staff: "âš ï¸ ØªØ£Ø®Ø± ÙƒØ¨ÙŠØ±: 45 Ø¯Ù‚ÙŠÙ‚Ø©. Ù‡Ù„ ÙŠØ±ØºØ¨ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"
- Staff confirms with parent
- Option to cancel without penalty (since significant time lost)
- If proceed: Session ends at original time

**More than 1 hour late**:
- Check-in **BLOCKED** (cutoff)
- Message: "âŒ Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø². Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ù…Ø±ÙˆØ± Ø³Ø§Ø¹Ø© Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©."
- Offer: "ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¬Ø² Ø£Ùˆ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ±Ø¯Ø§Ø¯"
- Booking marked as 'no_show'
- Refund policy applies (partial refund or credit for next booking)

---

### 3) Check-Out Rules

**Normal Check-Out Window**: **Shift end time Â± 15 minutes**

**Expected Behavior**:
- Parent arrives at or before shift end time
- Staff checks out child (QR or manual)
- No extra fees

**Early Check-Out** (before shift end):
- Allowed anytime
- No refund for unused time (policy: pay for reserved slot, not actual usage)
- Mark as 'early_checkout' with checkout_time

**On-Time Check-Out** (shift end Â± 10 min):
- Standard process
- No late fee

---

### 4) Late Pickup Fee Algorithm

**Grace Period**: **10 minutes after shift end time** (free)

**After Grace Period**: Late fees apply

**Fee Structure** (placeholder, configurable):

**Option A: Per-Interval Charging**
- First 15 min after grace: 30 SAR
- Next 15 min: 30 SAR
- After 30 min: 40 SAR per 15 min
- Rounding: Round up to next 15-min interval

**Example**:
- Shift end: 1:00 PM
- Grace until: 1:10 PM (free)
- Pickup at 1:32 PM â†’ Late by 22 minutes after grace
- Intervals: 
  - 1:10-1:25 PM (15 min): 30 SAR
  - 1:25-1:32 PM (7 min, rounds to 15 min): 30 SAR
- **Total fee: 60 SAR**

---

**Option B: Hourly Rate (Simpler)**
- First hour after grace: 50 SAR (flat)
- Each additional hour: 50 SAR
- Rounding: Round up to next hour

**Example**:
- Pickup at 1:35 PM (35 min late after grace)
- Rounds to 1 hour â†’ 50 SAR

---

**Cap Rules** (optional):

**Daily Cap**: Max late fee per day = 200 SAR
- Prevents excessive fees if parent extremely late

**Subscription Discount**: Monthly subscription customers get:
- 20% discount on late fees (incentive for loyalty)
- First 2 late pickups per month: Waived (grace)
- 3rd+ late pickup: Full fee applies

---

**Fee Application**:
1. Calculate late_minutes = check_out_time - (shift_end_time + grace_period)
2. If late_minutes <= 0: No fee
3. If late_minutes > 0:
   - Calculate intervals: CEIL(late_minutes / 15)
   - Calculate fee: intervals Ã— fee_per_interval
   - Apply cap if fee > daily_cap
   - Apply subscription discount if applicable
4. Create fee ledger entry:
   - booking_id
   - fee_type: 'late_pickup'
   - amount
   - status: 'pending' | 'paid'
5. Prompt staff to collect payment OR add to account

---

**Arabic Messages**:

| Scenario | Arabic Message |
|----------|----------------|
| Late Pickup Warning (at check-out) | â° ØªØ£Ø®Ø± Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·ÙÙ„ Ø¨Ù…Ù‚Ø¯Ø§Ø± [X] Ø¯Ù‚ÙŠÙ‚Ø©. Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: [amount] Ø±ÙŠØ§Ù„ |
| Late Fee Added to Invoice | âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ£Ø®ÙŠØ± Ù„Ù„ÙØ§ØªÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ |
| Late Fee Paid | âœ… ØªÙ… Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ([amount] Ø±ÙŠØ§Ù„) |
| Late Fee Waived (subscription grace) | â„¹ï¸ ØªÙ… Ø§Ù„ØªØ¬Ø§ÙˆØ² Ø¹Ù† Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ£Ø®ÙŠØ± (Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±) |
| Late Fee Capped | â„¹ï¸ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø­Ø¯ÙˆØ¯Ø© Ø¨Ù€ 200 Ø±ÙŠØ§Ù„ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙˆÙ…ÙŠ) |

---

### 5) Early Drop-Off Rules (Before Shift)

**Standard Policy**: Check-in not allowed before 30 min prior to shift

**Optional Early Drop-Off Service** (if facility offers):

**Hours**: Starting 6:00 AM (1 hour before earliest morning shift)

**Fee Structure**:
- 6:00-6:30 AM (before 6:30 window): 30 SAR for 30 min
- 5:30-6:00 AM (extra early): 50 SAR for 30 min
- Each additional 30 min earlier: +20 SAR

**Process**:
1. Parent arrives early
2. Staff offers early drop-off option: "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© ØªØ¨Ø¯Ø£ Ø§Ù„Ø³Ø§Ø¹Ø© 7:00. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙƒØ±ØŸ (Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©: 30 Ø±ÙŠØ§Ù„)"
3. If accepted:
   - Process payment (cash/card at reception)
   - Check in child with note: 'early_dropoff'
   - Create fee ledger entry
4. If declined:
   - Parent waits in reception or returns later

**Alternative**: No early drop-off service available
- Strict cutoff at 30 min prior
- Parent must wait

---

### 6) No Check-Out Recorded by Closing

**Scenario**: Facility closing time (e.g., 7:00 PM), child still marked as checked-in

**Detection**: Cron job at closing time checks for unclosed sessions

**Process**:

**Auto-Check-Out**:
- Set check_out_time = shift_end_time + reasonable_buffer (e.g., shift_end + 30 min)
- Status = 'auto_closed'
- Flag for manual review

**Late Fee Calculation**:
- If auto_check_out_time > shift_end_time + grace:
  - Calculate late fee based on buffer time
  - Add to fee ledger with status='pending'

**Alert Admin**:
- Dashboard notification: "âš ï¸ Ø·ÙÙ„ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡: [child_name], Ø§Ù„Ø­Ø¬Ø²: [booking_id]"
- Possible reasons: Staff forgot to check out, system glitch, child still on premises (emergency)

**Alert Parent**:
- SMS/WhatsApp: "Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ [child_name] Ø¨Ø´ÙƒÙ„ Ø±Ø³Ù…ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ù„Ù„ØªØ£ÙƒÙŠØ¯."
- If late fee: "Ø±Ø³ÙˆÙ… ØªØ£Ø®ÙŠØ± Ù…Ø­ØªÙ…Ù„Ø©: [amount] Ø±ÙŠØ§Ù„. Ø³ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØºØ¯Ø§Ù‹."

**Manual Resolution**:
- Admin reviews next day
- If child was picked up on time but staff forgot to check out:
  - Update check_out_time to actual time (from CCTV/staff memory)
  - Waive late fee
  - Audit log: 'manual_correction'
- If child actually picked up late:
  - Confirm late fee
  - Invoice parent

---

## E) MONTHLY DAY CARE SUBSCRIPTIONS vs SINGLE-DAY (English)

### Monthly Subscription Model

**Subscription Structure**:
- **Duration**: 30 days (calendar month OR 30 days from start date)
- **Allowed Days**: Configurable per plan
  - Typical: Sunday-Thursday (5 days/week) + some Fridays
  - Max days per month: 20-24 (accounts for weekends + holidays)
- **Shift Consistency**: Subscriber chooses shift type at purchase:
  - All morning shifts
  - All evening shifts
  - All full-day
  - Mixed (requires approval, e.g., morning Mon-Wed, evening Thu-Fri)

**How It Maps to Daily Bookings**:

**Option A: Pre-Scheduled Model**
- At subscription purchase, parent selects weekdays (e.g., Sun, Mon, Tue, Wed, Thu)
- System auto-creates bookings for all matching days in the month
  - Example: Jan 2026, Sundays = 5, Mondays = 5, ..., total = 20 bookings
- Each booking is a separate DayCareBooking record linked to subscription
- Parent can see all pre-scheduled days in calendar
- Cancellation: Parent can cancel individual days (up to X days/month) without penalty

**Option B: Entitlement Model (Flexible)**
- Subscription gives entitlement: "24 days available this month"
- Parent books days as needed (like visit pack)
- Each booking consumes 1 day from entitlement
- Flexibility: Parent can choose different shifts on different days (if plan allows)
- Downside: Requires parent to actively book, less predictable for facility capacity planning

**Recommended**: **Option A (Pre-Scheduled)** with flexible cancellation/rescheduling

---

### Pause/Freeze Rules for Day Care Subscriptions

**Eligibility**:
- Must have active subscription
- Min 7 days remaining in subscription
- Max 2 pauses per subscription lifetime

**Pause Duration**:
- Min: 7 consecutive days
- Max: 21 consecutive days (3 weeks)
- Cannot pause for just 1-2 days (use cancellation for individual days)

**Use Cases**:
- Family vacation
- Child illness (extended)
- Temporary relocation

**Process**:
1. Parent requests pause via app: Select start_date + duration
2. System validates (check limits, min days remaining)
3. If approved:
   - Cancel all pre-scheduled bookings during pause period
   - Set subscription status = 'paused'
   - Extend end_date by pause_duration days
   - Block new bookings during pause
4. Send confirmation: "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø¶Ø§Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù† [start] Ø¥Ù„Ù‰ [end]. Ø³ÙŠØªÙ… ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù…Ù‚Ø¯Ø§Ø± [X] ÙŠÙˆÙ…."

**Auto-Resume**:
- On resume_date: Status = 'active', bookings enabled
- If pre-scheduled model: Auto-reschedule missed days to end of month (if capacity allows)

---

### Makeup Days Policy (Missed Days)

**Scenarios for Missed Days**:
1. **Child illness** (parent cancels same-day or no-show due to illness)
2. **Facility closure** (emergency, maintenance)
3. **Holidays** (if subscription includes holiday days)

**Policy Options**:

**Option A: No Makeup (Standard)**
- Subscription pays for reserved slot, not attendance
- If child misses day (any reason), no makeup day provided
- Parent forfeits that day
- Pro: Simple, predictable revenue
- Con: Less flexible for parents

**Option B: Limited Makeup Days**
- Allow **2 makeup days per month** (for illness only)
- Parent must:
  - Cancel >2 hours before shift start
  - Provide reason (dropdown: illness, emergency)
  - Submit doctor's note (for >3 consecutive days)
- Makeup day scheduled within same month (if capacity available)
- Pro: Customer-friendly
- Con: Capacity planning complexity

**Option C: Full Flexibility (Premium Plans)**
- All-inclusive plan: Unlimited makeup days (within 90 days)
- Parent can reschedule any day (with 24-hour notice)
- Pro: Maximum flexibility, premium pricing justifies it
- Con: High capacity uncertainty

**Recommended**: **Option B** (limited makeup for standard plans, unlimited for premium)

**Implementation**:
- Track missed_days_count in subscription record
- If parent cancels with valid reason (<2 hours before, illness):
  - Increment makeup_days_available (max 2)
- Parent can use makeup day via app: "Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙŠÙˆÙ… ØªØ¹ÙˆÙŠØ¶ÙŠ" (Use Makeup Day)
- Select new date (from available dates)
- System creates new booking, decrements makeup_days_available

---

### Attendance Consumption for Subscriptions

**How Attendance Consumes Entitlement**:

**Pre-Scheduled Model**:
- Booking already exists (created at subscription purchase)
- Check-in does **not** consume anything (booking already allocated capacity)
- No-show or cancellation: Booking marked as 'cancelled' or 'no_show', capacity released
- Attendance tracked for reporting, but doesn't affect remaining days (already paid for)

**Entitlement Model**:
- Each check-in consumes 1 day from remaining_days
- Decrement at check-in (not at booking creation)
- If remaining_days = 0: Block further bookings until next month/renewal

**Recommended**: Pre-scheduled model (simpler accounting)

---

### Single-Day vs Subscription: Comparison

| Aspect | Single Day | Monthly Subscription |
|--------|------------|----------------------|
| **Purchase** | One-time booking | Upfront monthly payment |
| **Price** | Full per-day rate (e.g., 150 SAR) | Discounted (~15-20% cheaper per day, e.g., 2,400 SAR for 20 days = 120 SAR/day) |
| **Flexibility** | High (book any day, any shift) | Low-Medium (committed to scheduled days) |
| **Cancellation** | Strict policy (24-hour notice) | Flexible (can cancel individual days, pause subscription) |
| **Capacity Priority** | Standard | Higher (subscribers get priority capacity) |
| **Late Fee Discount** | None | 20% discount or first 2 waived/month |
| **Makeup Days** | N/A | Available (2/month) |
| **Add-Ons** | Pay per use | Discounted or included (all-inclusive plan) |

**Parent Incentive to Subscribe**:
- Cost savings
- Guaranteed capacity (pre-scheduled)
- Perks (late fee grace, makeup days, priority support)

---

## F) CAPACITY & STAFFING RULES (English)

### Capacity per Shift

**Configuration** (per shift, per day):
- **Morning Shift (7 AM-1 PM)**: Max 20 children
- **Evening Shift (1 PM-7 PM)**: Max 15 children (lower typical demand)
- **Full Day (7 AM-7 PM)**: Max 20 children (shared capacity with morning, separate from evening)

**Note**: Full-day bookings consume morning shift capacity (not separate pool)

**Capacity Allocation**:
- Total capacity = subscription pre-scheduled bookings + reserved slots for single-day walk-ins
- Example: Morning shift capacity = 20
  - Subscriptions: 14 pre-scheduled
  - Walk-in pool: 6 slots available
  - If walk-in pool fills up, can allocate from buffer (1-2 slots) or waitlist

---

### Waitlist Policy

**Trigger**: Shift capacity reaches 100%

**Process**:
1. **Parent attempts booking for full shift**:
   - System shows: "âš ï¸ Ø§Ù„ÙØªØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø©. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŸ" (Shift full. Join waitlist?)
   - Button: "Ø§Ù†Ø¶Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" (Join Waitlist)

2. **Waitlist Entry Created**:
   - Store: child_id, package_id, preferred_date, shift, timestamp
   - Send confirmation: "ØªÙ… Ø¥Ø¶Ø§ÙØªÙƒ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±. Ø³Ù†Ø¨Ù„ØºÙƒ Ø¥Ø°Ø§ ØªÙˆÙØ± Ù…ÙƒØ§Ù†."

3. **Slot Opens** (due to cancellation):
   - Auto-notify first person in waitlist (FIFO order)
   - SMS/WhatsApp: "âœ… ØªÙˆÙØ± Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ø­Ø¶Ø§Ù†Ø©! Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù† Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©: [booking_link]"
   - Booking window: 1 hour to confirm
   - If no response within 1 hour: Move to next in queue

4. **Waitlist Expiry**:
   - If date passes with no slot: Remove from waitlist, notify: "Ù„Ù„Ø£Ø³ÙØŒ Ù„Ù… ÙŠØªÙˆÙØ± Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø·Ù„ÙˆØ¨."

**Waitlist Priority**:
- Subscribers > Single-day bookers
- Timestamp order within each tier

---

### Overbooking Prevention

**Hard Capacity Limit**: Enforced at database level

**Constraint**: 
- Check capacity_available >= num_children_in_booking before confirming
- Use database transaction lock (SELECT FOR UPDATE) to prevent race condition
- If 2 bookings attempt to take last slot simultaneously: One succeeds, other gets "Capacity full" error

**No Overbooking Allowed**: 
- Unlike airlines, no intentional overbooking (safety/staff ratio regulations)
- If exceptional circumstance (VIP, emergency), requires manager override:
  - Manager can add 1-2 extra spots (emergency buffer)
  - Must justify in audit log
  - Must ensure staff ratio maintained (call in extra staff if needed)

---

### Staff Ratio Configuration

**Regulatory Requirement** (placeholder, adjust per local regulations):
- **Age 2-3**: 1 staff : 5 children
- **Age 4-5**: 1 staff : 6 children
- **Mixed age group**: Use lower ratio (1:5)

**System Configuration** (admin panel):
- Define min_staff_ratio per age group
- Define min_staff_count (absolute minimum, regardless of attendance)
  - E.g., Min 2 staff must be present at all times (safety)

**Capacity Enforcement Linked to Staff**:
- If only 2 staff scheduled for morning shift:
  - Max capacity = 2 Ã— 6 = 12 children (using 1:6 ratio)
- If 3 staff scheduled:
  - Max capacity = 3 Ã— 6 = 18 children
- If 4 staff scheduled:
  - Max capacity = 20 (capped by room size)

**Admin View** (staff scheduler):
- Assign staff to shifts
- System calculates max_capacity_based_on_staff
- Warn if bookings exceed calculated capacity: "âš ï¸ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (22) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (18). ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª."

---

### Emergency Contact Requirements

**Minimum Contacts**: 2 (primary + backup)

**Validation**:
- At least 1 contact must be authorized for pickup
- Phone numbers must be reachable (staff may call to verify)
- If only 1 contact provided: Block booking, show error: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ Ø·ÙˆØ§Ø±Ø¦ Ø«Ø§Ù†ÙŠØ© (Ù…Ø·Ù„ÙˆØ¨)"

**Emergency Protocol** (facility-level, not system):
- If child has incident and neither contact reachable:
  - Call emergency services (if medical emergency)
  - Keep child safe, continue attempts to reach parent
  - Log all attempts (time, method, outcome)
  - Last resort: Contact local authorities (child protective services) if parent unreachable for extended period

---

## G) MINIMUM DATA ENTITIES (English)

### 1) DayCarePlan

**Purpose**: Define day care package templates

**Fields**:
- id (UUID, PK)
- plan_name_en (e.g., "Half Day Morning")
- plan_name_ar (e.g., "Ù†ØµÙ ÙŠÙˆÙ… ØµØ¨Ø§Ø­ÙŠ")
- plan_type (enum: 'half_day_morning', 'half_day_evening', 'full_day', 'all_inclusive')
- shift_start_time (time, e.g., 07:00)
- shift_end_time (time, e.g., 13:00)
- duration_hours (decimal, e.g., 6)
- age_min (int, e.g., 2)
- age_max (int, e.g., 5)
- capacity_max (int, per shift)
- staff_ratio (decimal, e.g., 6 for 1:6)
- price_single_day (decimal)
- price_monthly_subscription (decimal, for ~20-24 days)
- included_meals (JSON array, e.g., ["snack", "lunch"])
- included_activities (JSON array, e.g., ["arts", "playground_30min"])
- included_areas (JSON array, e.g., ["daycare", "indoor_playground"])
- playground_time_minutes (int, e.g., 30)
- sand_area_included (boolean, default false)
- sand_time_minutes (int, nullable)
- add_ons_available (JSON array, e.g., ["sand_2hr", "extra_meal"])
- allowed_weekdays (JSON array, e.g., ["sun","mon","tue","wed","thu","fri"], null = all)
- cancellation_policy (text, policy description)
- active (boolean)
- created_at, updated_at

**Indexes**: (plan_type, active), (shift_start_time)

---

### 2) DayCareBooking

**Purpose**: Individual day care booking instance (single-day or part of subscription)

**Fields**:
- id (UUID, PK)
- booking_number (string, unique, e.g., "DC20260120-001")
- booking_type (enum: 'single_day', 'subscription') - indicates if part of subscription
- subscription_id (FK â†’ daycare_subscriptions.id, nullable) - if booking_type='subscription'
- user_id (FK â†’ users.id, parent)
- child_id (FK â†’ children.id)
- plan_id (FK â†’ daycare_plans.id)
- booking_date (date)
- shift (enum: 'morning', 'evening', 'fullday')
- shift_start_time (datetime, calculated from plan + date)
- shift_end_time (datetime)
- status (enum: 'draft', 'pending_payment', 'confirmed', 'checked_in', 'checked_out', 'cancelled', 'no_show', 'auto_closed')
- payment_status (enum: 'pending', 'paid', 'failed', 'refunded', 'free') - 'free' if subscription
- amount_paid (decimal, 0 if subscription)
- coupon_code (string, nullable)
- discount_amount (decimal)
- tax_amount (decimal)
- total_amount (decimal)
- payment_intent_id (string, from gateway)
- cancelled_at (datetime, nullable)
- cancellation_reason (text, nullable)
- cancelled_by (FK â†’ users.id or admins.id, nullable)
- refund_amount (decimal, nullable)
- notes (text, parent's booking notes)
- created_at, updated_at

**Indexes**: (booking_date, shift, status), (child_id, booking_date), (subscription_id), (booking_number)

---

### 3) DayCareSubscription

**Purpose**: Monthly subscription for day care

**Fields**:
- id (UUID, PK)
- subscription_number (string, unique, e.g., "DCS202601-045")
- user_id (FK â†’ users.id)
- child_id (FK â†’ children.id)
- plan_id (FK â†’ daycare_plans.id)
- shift_type (enum: 'morning', 'evening', 'fullday')
- start_date (date)
- end_date (date, start + 30 days)
- status (enum: 'draft', 'pending_payment', 'active', 'paused', 'expired', 'cancelled')
- allowed_weekdays (JSON array, e.g., ["sun","mon","tue","wed","thu"])
- max_days_per_month (int, e.g., 24)
- days_used (int, default 0) - if entitlement model
- makeup_days_available (int, default 2)
- pauses_used (int, default 0, max 2)
- paused_at (datetime, nullable)
- pause_duration_days (int, nullable)
- resume_date (datetime, nullable)
- amount_paid (decimal)
- payment_intent_id (string)
- payment_status (enum: 'pending', 'paid', 'failed')
- auto_renew (boolean, default false)
- renewed_from_subscription_id (FK â†’ daycare_subscriptions.id, nullable)
- cancelled_at (datetime, nullable)
- cancellation_reason (text, nullable)
- notes (text)
- created_at, updated_at

**Indexes**: (user_id, status), (child_id, status), (start_date, end_date), (subscription_number)

---

### 4) DayCareAttendance

**Purpose**: Track check-in/check-out events for each booking

**Fields**:
- id (UUID, PK)
- booking_id (FK â†’ daycare_bookings.id)
- child_id (FK â†’ children.id)
- attendance_date (date)
- shift (enum: 'morning', 'evening', 'fullday')
- check_in_time (datetime)
- check_out_time (datetime, nullable)
- scheduled_end_time (datetime)
- actual_duration_minutes (int, computed)
- check_in_method (enum: 'qr', 'manual', 'early_dropoff')
- check_out_method (enum: 'qr', 'manual')
- check_in_device_id (string, kiosk/device ID)
- check_out_device_id (string, nullable)
- check_in_staff_id (FK â†’ staff.id)
- check_out_staff_id (FK â†’ staff.id, nullable)
- assigned_staff_id (FK â†’ staff.id, nullable) - primary caregiver for the day
- late_arrival_minutes (int, default 0)
- late_pickup_minutes (int, default 0)
- late_pickup_fee (decimal, default 0)
- early_dropoff_fee (decimal, default 0)
- extension_minutes (int, default 0) - if parent requested extension
- extension_fee (decimal, default 0)
- picked_up_by (JSON, {type, name, phone, id_verified})
- child_condition_at_checkout (JSON, {health_status, incidents, notes})
- attendance_status (enum: 'present', 'late', 'early_checkout', 'late_pickup', 'no_show', 'auto_closed')
- staff_notes (text, nullable)
- created_at, updated_at

**Indexes**: (booking_id), (child_id, attendance_date), (attendance_date, shift), (attendance_status)

---

### 5) ChildProfile

**Purpose**: Store child details and health information

**Fields**:
- id (UUID, PK)
- parent_user_id (FK â†’ users.id)
- name (string)
- name_ar (string, nullable)
- date_of_birth (date)
- age (int, computed)
- gender (enum: 'male', 'female', 'other')
- photo_url (string, nullable)
- nationality (string, nullable)
- id_number (string, nullable, birth certificate or ID)
- special_needs (text, nullable)
- created_at, updated_at

**Linked Tables**:
- child_emergency_contacts (separate table for normalized storage)
- child_health_notes (separate table)

**Indexes**: (parent_user_id), (name), (date_of_birth)

---

### 6) ChildEmergencyContact

**Purpose**: Store emergency contacts for each child

**Fields**:
- id (UUID, PK)
- child_id (FK â†’ children.id)
- contact_type (enum: 'primary', 'secondary', 'other')
- name (string)
- relationship (enum: 'mother', 'father', 'grandmother', 'grandfather', 'sibling', 'other')
- phone (string)
- phone_alternate (string, nullable)
- email (string, nullable)
- authorized_for_pickup (boolean, default false)
- notes (text, nullable)
- created_at, updated_at

**Indexes**: (child_id, contact_type), (phone)

**Constraint**: Min 2 contacts per child (enforced at application level)

---

### 7) ChildHealthNotes

**Purpose**: Store health and allergy information

**Fields**:
- id (UUID, PK)
- child_id (FK â†’ children.id, unique) - one health record per child
- has_allergies (boolean, default false)
- allergies (JSON array, [{type: 'food', items: ['peanuts', 'dairy']}, {type: 'medication', items: ['penicillin']}])
- has_medical_conditions (boolean, default false)
- medical_conditions (text, description)
- has_medications (boolean, default false)
- medications (JSON array, [{name, dosage, timing, staff_can_administer: true/false, prescription_on_file: true/false}])
- dietary_restrictions (JSON array, e.g., ['vegetarian', 'dairy_free'])
- additional_notes (text, nullable)
- last_updated (datetime)
- parent_consent (boolean, required true)
- created_at, updated_at

**Indexes**: (child_id), (has_allergies), (has_medications)

---

### 8) AddOnPurchase

**Purpose**: Track add-on services purchased with day care booking

**Fields**:
- id (UUID, PK)
- booking_id (FK â†’ daycare_bookings.id)
- add_on_type (enum: 'sand_2hr', 'extra_meal', 'insurance', 'photo_service', 'workshop')
- add_on_name (string, e.g., "Ø³Ø§Ø¹ØªÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ù…Ù„")
- time_slot (string, nullable, e.g., "11:00-13:00")
- price (decimal)
- status (enum: 'pending', 'confirmed', 'used', 'cancelled')
- used_at (datetime, nullable) - when child actually used add-on
- staff_notes (text, nullable)
- created_at, updated_at

**Indexes**: (booking_id), (add_on_type, status)

---

### 9) FeesLedger

**Purpose**: Track all additional fees (late pickup, extensions, early dropoff)

**Fields**:
- id (UUID, PK)
- booking_id (FK â†’ daycare_bookings.id)
- attendance_id (FK â†’ daycare_attendance.id, nullable)
- fee_type (enum: 'late_pickup', 'early_dropoff', 'extension', 'add_on', 'other')
- description (string, e.g., "Late pickup: 25 minutes")
- amount (decimal)
- currency (string, default 'SAR')
- status (enum: 'pending', 'paid', 'waived', 'disputed')
- payment_method (enum: 'cash', 'card', 'account', 'online', nullable)
- paid_at (datetime, nullable)
- waived_by (FK â†’ admins.id, nullable) - if fee waived
- waived_reason (text, nullable)
- created_at, updated_at

**Indexes**: (booking_id, fee_type), (status, created_at), (attendance_id)

---

### 10) AuditLog

**Purpose**: Comprehensive audit trail for day care operations

**Fields**:
- id (UUID, PK)
- entity_type (enum: 'booking', 'subscription', 'attendance', 'payment', 'fee', 'admin_action')
- entity_id (UUID)
- action (enum: 'created', 'confirmed', 'checked_in', 'checked_out', 'cancelled', 'extended', 'fee_added', 'fee_waived', 'manual_override', etc.)
- actor_id (UUID, user/admin/staff who performed action)
- actor_type (enum: 'user', 'admin', 'staff', 'system', 'device')
- metadata (JSON, additional context)
- before_state (JSON, nullable, snapshot before change)
- after_state (JSON, nullable, snapshot after change)
- ip_address (string, nullable)
- device_id (string, nullable)
- timestamp (datetime, default now)

**Indexes**: (entity_id, action, timestamp), (actor_id, timestamp), (timestamp DESC)

---

## H) REPORTS (English, Names in Arabic)

### 1) ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ (Daily Attendance Report)

**Purpose**: Overview of today's day care attendance across all shifts

**Filters**:
- Date (default: today)
- Shift (morning / evening / full day / all)
- Plan type (all / half-day / full-day / all-inclusive)

**Metrics**:
- **Total Bookings**: Count of confirmed bookings for selected date/shift
- **Checked In**: Count of children currently checked in
- **Checked Out**: Count of children already picked up
- **No-Shows**: Count of bookings with no check-in (past grace period)
- **Late Arrivals**: Count of check-ins >30 min late
- **Late Pickups**: Count of check-outs with late pickup fees
- **Average Duration**: Average time children spent (checked-out children only)
- **Capacity Utilization**: (Checked In / Max Capacity) Ã— 100%

**Data Breakdown**:
- Table: List of all children (name, check-in time, check-out time, status, late fees)
- Export options: PDF, Excel, CSV

**Data Source**: DayCareBooking + DayCareAttendance tables

**API**: GET /api/reports/daycare/daily-attendance?date=2026-01-20&shift=morning

---

### 2) ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª â€“ Ø§Ù„Ø­Ø¶Ø§Ù†Ø© (Day Care Revenue Report)

**Purpose**: Financial overview of day care revenue

**Filters**:
- Date range (default: current month)
- Plan type (single-day / subscription / all)
- Payment status (paid / pending / failed)

**Metrics**:
- **Total Revenue**: Sum of all payments received
  - Breakdown by:
    - Single-day bookings
    - Monthly subscriptions
    - Add-ons
    - Late pickup fees
    - Extension fees
- **Average Revenue per Child**: Total revenue / unique children
- **Revenue by Plan Type**: Pie chart (half-day morning, half-day evening, full-day, all-inclusive)
- **Revenue by Payment Method**: Card, cash, online, account
- **Pending Fees**: Sum of unpaid late fees + extensions
- **Refunds Issued**: Sum of refunded amounts

**Data Breakdown**:
- Daily revenue trend (line chart)
- Top revenue days (bar chart)
- Revenue by shift (morning vs evening vs full-day)

**Data Source**: DayCareBooking, DayCareSubscription, FeesLedger, PaymentOrder tables

**API**: GET /api/reports/daycare/revenue?start_date=2026-01-01&end_date=2026-01-31

---

### 3) ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø¹Ø© (Capacity Utilization Report)

**Purpose**: Analyze capacity usage to optimize bookings and staffing

**Filters**:
- Date range
- Shift (morning / evening / full-day)
- Weekday (to see patterns, e.g., Mondays busier than Thursdays)

**Metrics**:
- **Average Occupancy Rate**: Average (checked_in_count / max_capacity) across date range
- **Peak Days**: Days with highest occupancy
- **Low Days**: Days with <50% occupancy (opportunity for promotions)
- **Waitlist Frequency**: How often waitlist activated (capacity full)
- **Staff-to-Child Ratio Actual**: Actual ratio based on attendance (vs planned)

**Visualizations**:
- Heatmap: Day of week Ã— Week of month â†’ color-coded by occupancy %
- Line chart: Daily occupancy trend
- Bar chart: Occupancy by shift

**Data Source**: DayCareAttendance, DayCareBooking, StaffSchedule tables

**API**: GET /api/reports/daycare/capacity?start_date=2026-01-01&end_date=2026-01-31

---

### 4) ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„ÙØ±Ø¯ÙŠ (Individual Child Report)

**Purpose**: Detailed report for a specific child (for parent or admin)

**Filters**:
- Child ID (selected from dropdown)
- Date range

**Metrics**:
- **Total Days Attended**: Count of check-ins
- **Total Hours**: Sum of actual duration
- **Average Session Duration**: Average duration per day
- **Late Arrivals**: Count + dates
- **Late Pickups**: Count + total late fees
- **No-Shows**: Count + dates
- **Add-Ons Used**: List of add-ons (sand time, extra meals, etc.)
- **Incidents**: Any reported incidents from check-out condition reports

**Visualizations**:
- Calendar view: Days attended (color-coded: present, late, no-show)
- Activity timeline: Check-in/out times across days

**Export**: PDF report with child photo, parent info, attendance summary (shareable with parent)

**Data Source**: DayCareAttendance, ChildProfile, FeesLedger tables

**API**: GET /api/reports/daycare/child/{child_id}?start_date=2026-01-01&end_date=2026-01-31

---

### 5) ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Monthly Subscriptions Report)

**Purpose**: Track subscription performance and renewal rates

**Filters**:
- Month (default: current month)
- Subscription status (active / paused / expired / cancelled)

**Metrics**:
- **Total Active Subscriptions**: Count
- **New Subscriptions**: Count of subscriptions started this month
- **Renewed Subscriptions**: Count of renewals
- **Cancelled Subscriptions**: Count + cancellation reasons (breakdown)
- **Paused Subscriptions**: Count + pause reasons
- **Renewal Rate**: (Renewed / Expiring this month) Ã— 100%
- **Average Subscription Value**: Average amount paid per subscription
- **Makeup Days Used**: Total + average per subscription

**Data Breakdown**:
- Table: List of subscriptions (child name, plan, start date, end date, status, days used)
- Cancellation reasons: Pie chart (cost, dissatisfied, moved, child aged out, etc.)

**Data Source**: DayCareSubscription, DayCareBooking tables

**API**: GET /api/reports/daycare/subscriptions?month=2026-01

---

### 6) ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Additional Fees Report)

**Purpose**: Track and reconcile late fees, extensions, and other charges

**Filters**:
- Date range
- Fee type (late_pickup / early_dropoff / extension / add_on)
- Payment status (paid / pending / waived)

**Metrics**:
- **Total Fees Charged**: Sum of all fees
- **Fees Collected**: Sum of paid fees
- **Pending Fees**: Sum of unpaid fees
- **Waived Fees**: Sum of fees waived (with reasons)
- **Average Late Pickup Fee**: Average amount per late pickup
- **Late Pickup Frequency**: % of bookings with late pickup

**Data Breakdown**:
- Table: List of fees (child, date, type, amount, status, waived reason)
- Trend: Daily/weekly fee totals (line chart)

**Use Case**: Identify repeat late-pickers (for follow-up reminders or policy enforcement)

**Data Source**: FeesLedger, DayCareAttendance tables

**API**: GET /api/reports/daycare/fees?start_date=2026-01-01&end_date=2026-01-31&status=all

---

### 7) ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© (Health & Safety Report)

**Purpose**: Track health-related incidents and compliance

**Filters**:
- Date range
- Incident type (injury / illness / allergy reaction / medication error / other)

**Metrics**:
- **Total Incidents**: Count
- **Incident Rate**: Incidents per 100 child-days
- **Children with Allergies**: Count (from health notes)
- **Children on Medications**: Count
- **Staff Training Compliance**: % of staff with current certifications (first aid, CPR)

**Data Breakdown**:
- Incident log table (date, child, type, description, first aid, parent notified)
- Allergy summary: List of all active children with allergies (for staff reference)

**Compliance Notes**:
- Flag children missing required vaccination records
- Flag staff due for training renewal

**Data Source**: ChildHealthNotes, DayCareAttendance (incidents from child_condition_at_checkout), StaffCertifications table

**API**: GET /api/reports/daycare/health-safety?start_date=2026-01-01&end_date=2026-01-31

---

## IMPLEMENTATION CHECKLIST

### Backend APIs to Implement

**Booking APIs**:
- GET /api/daycare/plans (list all packages)
- GET /api/daycare/availability?package_id={id}&date={date} (check capacity)
- GET /api/daycare/calendar?package_id={id}&month={YYYY-MM} (month availability)
- POST /api/daycare/bookings/checkout (single-day booking)
- POST /api/daycare/subscriptions/checkout (monthly subscription)
- GET /api/daycare/bookings?user_id={id}&status={status} (list user's bookings)
- GET /api/daycare/bookings/{id} (booking details)
- GET /api/daycare/bookings/{id}/qr (generate QR code)
- POST /api/daycare/bookings/{id}/cancel (cancel booking)
- POST /api/daycare/bookings/{id}/extend (extend time)
- POST /api/daycare/bookings/{id}/add-activity (add sand/playground time)

**Check-In/Out APIs**:
- POST /api/daycare/check-in (check in child)
- POST /api/daycare/check-out (check out child)
- GET /api/reception/daycare/today (reception dashboard)
- POST /api/daycare/attendance/{id}/add-fee (add late fee manually)

**Subscription APIs**:
- POST /api/daycare/subscriptions/{id}/pause (pause subscription)
- POST /api/daycare/subscriptions/{id}/resume (resume subscription)
- POST /api/daycare/subscriptions/{id}/cancel (cancel subscription)
- POST /api/daycare/subscriptions/{id}/use-makeup-day (schedule makeup day)

**Child/Health APIs**:
- POST /api/children (create child profile)
- PATCH /api/children/{id} (update child info)
- POST /api/children/{id}/health-notes (add/update health notes)
- GET /api/children/{id}/emergency-contacts (get contacts)

**Reports APIs**:
- GET /api/reports/daycare/daily-attendance
- GET /api/reports/daycare/revenue
- GET /api/reports/daycare/capacity
- GET /api/reports/daycare/child/{child_id}
- GET /api/reports/daycare/subscriptions
- GET /api/reports/daycare/fees
- GET /api/reports/daycare/health-safety

### Cron Jobs

- **Daily Attendance Cleanup** (10 PM):
  - Auto-close unclosed sessions
  - Calculate late fees
  - Generate daily report

- **Subscription Expiry** (12 AM):
  - Mark expired subscriptions
  - Trigger auto-renewal if enabled

- **Waitlist Notifications** (every 30 min):
  - Check for cancellations
  - Notify next in waitlist

- **Reminder Notifications**:
  - Day before booking: Send reminder to parent
  - 2 hours before shift: Send reminder with QR code
  - Shift end -15 min: Send pickup reminder to parent

### Notifications

- **WhatsApp** (preferred for parents):
  - Booking confirmed
  - Check-in success
  - Check-out success with daily report
  - Late pickup warning
  - Extension confirmed
  - Incident report (if any)

- **SMS** (backup):
  - Same as WhatsApp

- **Email**:
  - Booking confirmation with detailed info
  - Invoice/receipt
  - Monthly subscription summary

### Security & Validation

- QR checksum validation (prevent tampering)
- Health screening required at check-in
- Pickup authorization validation (only authorized persons)
- ID verification for "other person" pickups
- Audit log for all sensitive actions (check-in/out, fee waiver, admin overrides)

### Testing Scenarios

- Book single-day â†’ check-in â†’ check-out (normal flow)
- Book subscription â†’ pre-schedule days â†’ check-in multiple days
- Late arrival (within grace) â†’ check-in allowed
- Late arrival (>1 hour) â†’ check-in blocked
- Late pickup â†’ calculate fees â†’ collect payment
- Early drop-off â†’ charge extra fee
- Cancel booking (>24 hours) â†’ refund
- Cancel booking (<24 hours) â†’ no refund
- Capacity full â†’ join waitlist â†’ slot opens â†’ notify
- Pause subscription â†’ verify check-in blocked â†’ resume â†’ verify check-in works
- Manual check-out (forgot to scan) â†’ verify pickup authorization
- Health incident â†’ report filled â†’ parent notified
- Child with allergy â†’ check staff alerted at check-in
- Admin waive late fee â†’ verify audit log

---

END OF DOCUMENT
